# Changelog

All notable changes to this project will be documented in this file.

## [0.8.3] - 2023-01-24

### Bug Fixes

- Stop removing uppercase characters in ldapEscape

## [0.8.2] - 2023-01-24

### Bug Fixes

- **LDAP**: Don't ignore the `userFilter` config option

### Features

- Repair username mapping database at startup by setting `maintenance.repairDb` to true

## [0.8.1] - 2023-01-16

### Bug Fixes

- **LDAP:** Don't store the mxid as the uid in the username mapper

### Features

- **LDAP**: Validate configuration
- Gracefully handle failed stage initialization

## [0.8.0] - 2023-01-10

### Bug Fixes

- Don't log stacktrace on failed HTTP requests
- Deserialize stored username mappings correctly
- **LDAP**: Don't crash on any failed searches

### Miscellaneous Tasks

- Correct outdated links
- Move username mapping data generated by tests to an ignored location

### Refactor

- Use JWT claim instead of client-server API to set display name
- Use the io-ts library for deserialization of username mapper entries
- [**breaking**] Validate configuration on launch, remove template functionality:
	- Remove `stages` key from configuration
	- Remove `templates` key from configuration
	- Make `usernameMapper.mode` case sensitive again (but validate the case)
	- Remove `uia.default`, every endpoint must be explicitly configured

## [0.7.12] - 2022-10-05

### Bug Fixes

- Make user name mapping mode configuration value case insensitive
- Improve some log messages

### Features

- Accept any mime-type for JSON requests

## [0.7.11] - 2022-09-19
### Bug Fixes

- Don't crash when introspection fails
- Accept `m.login.token` auth type as a response to `m.login.sso`
- Catch more exceptions

### Features

- Make namespaced mxids optional

### Miscellaneous Tasks

- Upgrade lock file and emcascript target

### Refactor

- Allow arbitrary stage completion order

## [0.7.10] - 2022-08-16

### Features

**OpenId**:
- Allow overriding autodiscovered provider info
- Allow SSO sessions without an associated UIA session

## [0.7.9] - 2022-08-11

### Features

- Advertise `m.login.sso` in GET /login

## [0.7.8] - 2022-08-09

## Features

- OpenID Connect: JSON redirect mode

### Bug Fixes

- LDAP: Add missing escaping for LDAP search base

## [0.7.7] - 2022-08-05

## Features

- LDAP: Binary attributes can be used as persistent IDs

## [0.7.6] - 2022-06-21

### Documentation

- Add doc comments for LDAP config types

### Features

- OIDC token introspection
- Make LDAP persistentID search filter configurable

## [0.7.5] - 2022-04-25

### Features

- Let LDAP set admin status

### Miscellaneous Tasks

- Support v3 api prefix
- Bump version to 0.7.5

### Refactor

- Preserve more types in LDAP code

## [0.7.4] - 2022-04-05

### Bump

- Version 0.7.4

## [0.7.3] - 2022-03-28

### Features

- Let stages set the admin status of a user
- CRM stage handles admin status
- OpenID stage can set admin status
- Graceful shutdown/install signal handlers

### Miscellaneous Tasks

- Bump to 0.7.3

### Refactor

- Make copy of IExtraSessionData less error prone

## [0.7.2] - 2022-03-14

### Bug Fixes

- Fetch key correctly

### Testing

- CRM stage tests

### Update

- Bump version to 0.7.2

## [0.7.1] - 2022-03-10

### Features

- Advertise com.famedly.login.msc2835 on GET login

### Miscellaneous Tasks

- Bump to v0.7.1

## [0.7.0] - 2022-03-03

### Features

- Better error messages for SSO login
- Log when display name doesn't need updating
- Implement com.famedly.login.crm stage

### Miscellaneous Tasks

- Bump to version 0.7.0

### Ci

- Remove the rust template

## [0.6.2] - 2022-01-20

### Bug Fixes

- Displaynames not being updated on login

### Features

- Set up displayname on login for ldap

### Miscellaneous Tasks

- Fix typos
- Add more logging to name updates
- Add more logging to SSO flow
- Bump version to 0.6.2

## [0.6.1] - 2021-11-19

### Bug Fixes

- Handle fallbacks to usernames inferred from localpart correctly when authenticating

### Features

- Set display name from OIDC claim

### Update

- Bump version to 0.6.1

## [0.6.0] - 2021-10-07

### Bug Fixes

- Path to dev-env
- Ci
- Prevent memory leak
- Fix lint error by moving literal to constant
- Fix incorrect import and proxyquire usage
- Allow username mapper mode config to be case-insensitive

### Documentation

- Add some doc and code comments
- Add info about OpenID to readme

### Features

- Add OpenID Connect authentication
- Allow filtering users

### Miscellaneous Tasks

- Update famedly-matrix-middleware url
- Upgrade dependencies
- Address warnings
- Update name in README

### Refactor

- Nicer codebase for having all openid stuff in the stage handlers

### Testing

- Move e2e tests downstream

### Ci

- E2e tests per commit
- Move logs output to after_script
- Proper docker caching
- Use commit sha instead of ref name
- Drop user-stories

### Update

- Bump version to 0.6.0

## [0.5.1] - 2021-05-26

### Bug Fixes

- Image variable must point to a file on  VM host, tag currently untagged jobs

### Refactor

- Readability

### Testing

- Unauthorized requests
- Delete_devices and upload_signing_keys
- Password_stage_invalid_creds
- Password change

### Ci

- Change dockerfile to python3

## [0.5.0] - 2021-04-26

### Features

- Allow different modes for username mapping

### Miscellaneous Tasks

- Rename package to reflect project name, update Dockerfile accordingly

## [0.4.0]
 - Add `default` stage handler config
 - Proxy device signing key upload

## [0.3.0]
 - Make UIA dynamic
 - Add `com.famedly.login.welcome_message` stage

## [0.2.0]
### Changes
 - Change LDAP layout to make more sense

## [0.1.0]
### New features
 - Support deactivated users in ldap password provider

<!-- generated by git-cliff -->
